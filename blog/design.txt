1:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/a45d4bf9bd4f0720.css","style",{"crossOrigin":""}]
0:["kIde8mlMRhUTUL0juBNt1",[[["",{"children":["blog",{"children":[["slug","design","d"],{"children":["__PAGE__?{\"slug\":\"design\"}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a45d4bf9bd4f0720.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:HL["/_next/static/css/5eacd01f773eed7f.css","style",{"crossOrigin":""}]
6:I[73994,["3185","static/chunks/app/layout-18013056569e47f9.js"],""]
7:I[56954,[],""]
8:I[7264,[],""]
9:I[68326,["721","static/chunks/0d701aaf-6c2ac696d912877c.js","9982","static/chunks/93854f56-90f3d10decf03a41.js","8326","static/chunks/8326-c7276deb3f3f6e36.js","5043","static/chunks/5043-ed4fa9bcc7bd6fde.js","308","static/chunks/app/blog/%5Bslug%5D/page-266b108b1d0b5221.js"],""]
3:[null,["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico","sizes":"any"}],["$","$L6",null,{"src":"/load.js"}],["$","$L6",null,{"id":"MathJax-script","async":true,"src":"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js","strategy":"afterInteractive"}]]}],["$","body",null,{"className":"__className_e66fe9","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","main",null,{"className":"flex min-h-screen flex-col items-center justify-between p-8","children":[["$","nav",null,{"className":"w-full sticky z-10 top-0 background-colour","children":["$","div",null,{"className":"block p-8 flex w-auto w-full flex-grow items-center","children":[["$","div",null,{"className":"flex-grow","children":["$","a",null,{"href":"/","className":"mt-0 block inline-block font-bold text-white","children":"¯\\_(ツ)_/¯"}]}],["$","div",null,{"children":[["$","a",null,{"href":"/blog","className":"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400","children":"blog"}],["$","a",null,{"href":"/projects","className":"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400","children":"projects"}]]}]]}]}],["$","div",null,{"className":"relative flex flex-grow place-items-center","children":["$","div",null,{"className":"place-items-center text-center","children":[["$","div",null,{"children":["$","h1",null,{"className":"mb-10 text-5xl font-bold","style":{"color":"#EBBAB9"},"children":"Not found :("}]}],["$","$L9",null,{"href":"/","className":"text-xl font-bold text-pink-300","style":{"color":"#FF9997"},"children":"Return home?"}]]}]}]]}],"notFoundStyles":[],"initialChildNode":[null,["$","div",null,{"className":"justify-top flex flex-col min-h-screen","children":[["$","nav",null,{"className":"w-full sticky z-10 top-0 background-colour","children":["$","div",null,{"className":"block p-8 flex w-auto w-full flex-grow items-center","children":[["$","div",null,{"className":"flex-grow","children":["$","a",null,{"href":"/","className":"mt-0 block inline-block font-bold text-white","children":"¯\\_(ツ)_/¯"}]}],["$","div",null,{"children":[["$","a",null,{"href":"/blog","className":"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400","children":"blog"}],["$","a",null,{"href":"/projects","className":"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400","children":"projects"}]]}]]}]}],["$","main",null,{"className":"justify-top flex flex-col items-center p-8","children":[["$","div",null,{"className":"secondary-colour place-items-start text-3xl font-bold","children":"My ramblings"}],["$","div",null,{"className":"mt-10 grid w-10/12 text-left","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children",["slug","design","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":["$La","$Lb",null],"childPropSegment":"__PAGE__?{\"slug\":\"design\"}","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5eacd01f773eed7f.css","precedence":"next","crossOrigin":""}]]}],"childPropSegment":["slug","design","d"],"styles":null}]}]]}]]}],null],"childPropSegment":"blog","styles":null}]}]]}],null]
4:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"SleepySwords"}],["$","meta","3",{"name":"description","content":"Portfolio website"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"256x256"}],["$","meta","5",{"name":"next-size-adjust"}]]
c:I[88390,["721","static/chunks/0d701aaf-6c2ac696d912877c.js","9982","static/chunks/93854f56-90f3d10decf03a41.js","8326","static/chunks/8326-c7276deb3f3f6e36.js","5043","static/chunks/5043-ed4fa9bcc7bd6fde.js","308","static/chunks/app/blog/%5Bslug%5D/page-266b108b1d0b5221.js"],""]
d:I[50834,["721","static/chunks/0d701aaf-6c2ac696d912877c.js","9982","static/chunks/93854f56-90f3d10decf03a41.js","8326","static/chunks/8326-c7276deb3f3f6e36.js","5043","static/chunks/5043-ed4fa9bcc7bd6fde.js","308","static/chunks/app/blog/%5Bslug%5D/page-266b108b1d0b5221.js"],"CodeBlock"]
e:I[65185,["721","static/chunks/0d701aaf-6c2ac696d912877c.js","9982","static/chunks/93854f56-90f3d10decf03a41.js","8326","static/chunks/8326-c7276deb3f3f6e36.js","5043","static/chunks/5043-ed4fa9bcc7bd6fde.js","308","static/chunks/app/blog/%5Bslug%5D/page-266b108b1d0b5221.js"],""]
b:["$","main",null,{"className":"flex","style":{"gridTemplateColumns":"1fr 4fr 1fr"},"children":[["$","div",null,{"className":"hidden shrink-0 grow-0 basis-64 sm:flex","children":["$","div",null,{"children":["$","ul",null,{"className":"sticky top-36","children":[["$","li",null,{"className":"mb-5 text-2xl font-bold","children":"All blogs"}],[["$","li","0",{"children":["$","$L9",null,{"href":"/blog/design","className":"text-1xl text-white underline transition-colors hover:text-gray-400","children":"Design is hard"}]}],["$","li","1",{"children":["$","$L9",null,{"href":"/blog/first","className":"text-1xl text-white underline transition-colors hover:text-gray-400","children":"It's alive!"}]}]]]}]}]}],["$","div",null,{"className":"remove-all flex-grow","children":[["$","div",null,{"className":"mb-5 text-3xl font-bold","children":["Design is hard"," - ","14/01/2024"]}],["$","$Lc",null,{"children":["$","article",null,{"children":[["$","h1",null,{"id":"The app","className":"","children":"The app"}],["$","p",null,{"children":["The design of the Rust TUI app, ",["$","code",null,{"children":"DoTodo"}],", should be fairly straightforward. You have tasks, configs and other things. It should not be that hard to design something like this, ",["$","strong",null,{"children":"RIGHT?"}],"."]}],["$","p",null,{"children":"Well, it is fairly simple, with the exception of one things. Overlays. They can get quite painful. Unlike the rest of the app which remain quite static, overlays can be pushed onto the screen and removed off the screen at a moments notice. This incosistent nature along with Rust borrow checker can lead to a lot of pain."}],["$","h1",null,{"id":"The problem","className":"","children":"The problem"}],["$","p",null,{"children":"The problem mainly lies with the concept that you cannot remove the overlay while in a method of an overlay. For example, the following signature with the data structures is not allowed."}],["$","$Ld",null,{"data-language":"rust","children":"pub struct App {\n    overlays: Vec<Overlay>,\n    other: ImportThings\n}\n\npub struct Overlay {\n    overlay: Things\n}\n\nimpl Overlay {\n    pub fn key_event(&mut self, app: &mut App) {}\n}\n"}],["$","p",null,{"children":["This in handsight, is fairly obvious. It is pretty clear that you are able to just remove the overlay from the ",["$","code",null,{"children":"overlays"}]," vec and that would definately cause some memory issues. So to combat this, there was a seperate ",["$","code",null,{"children":"StackLayout"}]," and the ",["$","code",null,{"children":"App"}],". The ",["$","code",null,{"children":"StackLayout"}]," acted as a way to hold basically every widget, from ",["$","code",null,{"children":"MainScreen"}]," to every overlay."]}],["$","p",null,{"children":["This was pretty alright. It worked alright, but the question then became, how would you add or remove elements if the ",["$","code",null,{"children":"MainScreen"}]," was inaccesible from ",["$","code",null,{"children":"key_event"}],". The answer that I thought at the time was callbacks. The callbacks were stored in ",["$","code",null,{"children":"App"}]," and were \"flushed\" and executed at the end of the event. This was fine to work with."]}],["$","h1",null,{"id":"Refactor","className":"","children":"Refactor"}],["$","p",null,{"children":["There was a refactor, mainly because this was a component based system, so a lot of the logic that did not really need to be spread out was in multiple different files. This made it much more harder to track where a certain input was handled. In an effort to combat this, an ",["$","code",null,{"children":"elm"}]," structure was put in place. This meant everything was in the ",["$","code",null,{"children":"App"}],". The concept of a ",["$","code",null,{"children":"StackLayout"}]," was removed."]}],["$","p",null,{"children":"This resulted in access to overlays to be more like this"}],["$","$Ld",null,{"data-language":"rust","children":"fn draw(app: &mut App) {\n    if let Some(Overlay::Input(input)) = app.last() {\n        // Stuff\n    }\n}\n"}],["$","p",null,{"children":["Notice how there is no reference to self. This is because of the issue described in ",["$","a",null,{"href":"#The%20problem","className":"underline transition-colors hover:text-gray-400","children":"the problem"}],". This also as a result, does not allow for composable overlays. Since drawing, key and mouse inputs always fetch the overlays data from the last element of the ",["$","code",null,{"children":"App"}]," overlay vec. There is no way you would be able to draw or pass inputs to another overlay, as it fetched that data from someplace else. While this does not really an issue. I was bothered with it."]}],["$","h1",null,{"id":"Refactor 2","className":"","children":"Refactor 2"}],["$","p",null,{"children":["Based on the ",["$","code",null,{"children":"Component"}]," architecture laid out in the ratatui documentation. The third attempt consisted of inputs returning a ",["$","code",null,{"children":"PostEvent"}]," structure. This structure consisted of a ",["$","code",null,{"children":"Action"}]," enum which had things like ",["$","code",null,{"children":"PopLayer"}]," and ",["$","code",null,{"children":"PushLayer"}],". This ",["$","code",null,{"children":"Action"}]," would then be returned to the main loop and be executed. This is very similar to the callbacks solution. Almost the exact same."]}],["$","p",null,{"children":["However, it retained the elements of the ",["$","code",null,{"children":"elm"}]," structure. Elements that should have been shared in the first place, such as the ",["$","code",null,{"children":"tasklist"}]," and ",["$","code",null,{"children":"completed list"}]," index which are also accessed by a viewer component are now stored in the ",["$","code",null,{"children":"App"}],". It was previously passed around using ",["$","code",null,{"children":"Rc<RefCell>"}]," which was significantly more ugly. So that is a plus, I guess?"]}],["$","h1",null,{"id":"Full circle","className":"","children":"Full circle"}],["$","p",null,{"children":["I've come to start thinking if I've just come full circle. With every iteration, it seems more and more meaningless to worry about how the ",["$","code",null,{"children":"Overlays"}]," are actually implemented and to just focus on adding new features. It might be better to not always just overengineer things and really only consider refactoring when an issue occurs."]}],["$","p",null,{"children":["This obviosuly comes with the caveat that it is much harder to refactor thing the larger a project grows. I very much felt this when refactoring this project, and it is relatively small. Perhaps, I should've thought the base architecture a little more through before jumping right in. Perhaps if I did I would've encountered unforseen problems. I'm not really sure what you would do, I guess just chug along and make cool stuff. In the end ",["$","em",null,{"children":"design is hard"}],"."]}]]}]}]]}],["$","div",null,{"className":"hidden shrink-0 grow-0 basis-64 lg:flex","children":["$","$Le",null,{"tableOfContents":[{"title":"The app","level":1},{"title":"The problem","level":1},{"title":"Refactor","level":1},{"title":"Refactor 2","level":1},{"title":"Full circle","level":1}]}]}]]}]
a:null
