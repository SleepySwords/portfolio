<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e334f867d0e43cc2.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5eacd01f773eed7f.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-eda54a44a67fc8da.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-fbc31cf734971914.js" async="" crossorigin=""></script><script src="/_next/static/chunks/2472-22d18f04124a9580.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-9ef897228362e690.js" async="" crossorigin=""></script><script src="/_next/static/chunks/app/layout-e13c4db65dc2fe40.js" async=""></script><script src="/_next/static/chunks/0d701aaf-6c2ac696d912877c.js" async=""></script><script src="/_next/static/chunks/93854f56-90f3d10decf03a41.js" async=""></script><script src="/_next/static/chunks/8326-eb81b36abe5748ad.js" async=""></script><script src="/_next/static/chunks/5043-8d108951930f4695.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-490776ed35ef27c4.js" async=""></script><link rel="preload" href="/load.js" as="script"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" as="script"/><title>SleepySwords</title><meta name="description" content="Portfolio website"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><meta name="next-size-adjust"/><link rel="icon" href="/favicon.ico" sizes="any"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="__className_e66fe9"><div class="flex min-h-screen flex-col"><nav class="w-full sticky z-10 top-0 background-colour"><div class="block p-8 flex w-auto w-full flex-grow items-center"><div class="flex-grow"><a href="/" class="mt-0 block inline-block font-bold text-white">¯\_(ツ)_/¯</a></div><div><a href="/blog" class="px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400">blog</a><a href="/projects" class="px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400">projects</a></div></div></nav><main class="justify-top flex flex-col items-center p-8"><div class="secondary-colour place-items-start text-3xl font-bold">My ramblings</div><div class="mt-10 grid w-10/12 text-left"><main class="flex" style="grid-template-columns:1fr 4fr 1fr"><div class="hidden shrink-0 grow-0 basis-64 sm:flex"><div><ul class="sticky top-36"><li class="mb-5 text-2xl font-bold">All blogs</li><li><a class="text-1xl text-white underline transition-colors hover:text-gray-400" href="/blog/design">Design is hard</a></li><li><a class="text-1xl text-white underline transition-colors hover:text-gray-400" href="/blog/first">It&#x27;s alive!</a></li></ul></div></div><div class="remove-all flex-grow"><div class="mb-5 text-3xl font-bold">Design is hard<!-- --> - <!-- -->14/01/2024</div><article><h1 id="The app" class="scroll-mt-24">The app</h1><p>The design of the Rust TUI app, <code>DoTodo</code>, should be fairly straightforward. You have tasks, configs and other things. It should not be that hard to design something like this, <strong>RIGHT?</strong>.</p><p>Well, it is fairly simple, with the exception of one things. Overlays. They can get quite painful. Unlike the rest of the app which remain quite static, overlays can be pushed onto the screen and removed off the screen at a moments notice. This incosistent nature along with Rust borrow checker can lead to a lot of pain.</p><h1 id="The problem" class="scroll-mt-24">The problem</h1><p>The problem mainly lies with the concept that you cannot remove the overlay while in a method of an overlay. For example, the following signature with the data structures is not allowed.</p><div class="relative"><div class="flex absolute border rounded p-1.5 border-neutral-700 {}hover:bg-neutral-900 bg-neutral-800 right-2 top-2 text-neutral-300 cursor-pointer transition-colors"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"></path><path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z"></path></svg></div><pre class="whitespace-pre-wrap language-rust"><code class="language-rust hljs overflow-clip rounded border border-neutral-700 bg-black bg-neutral-800/30" style="overflow-wrap:anywhere">pub struct App {
    overlays: Vec&lt;Overlay&gt;,
    other: ImportThings
}

pub struct Overlay {
    overlay: Things
}

impl Overlay {
    pub fn key_event(&amp;mut self, app: &amp;mut App) {}
}
</code></pre></div><p>This in handsight, is fairly obvious. It is pretty clear that you are able to just remove the overlay from the <code>overlays</code> vec and that would definately cause some memory issues. So to combat this, there was a seperate <code>StackLayout</code> and the <code>App</code>. The <code>StackLayout</code> acted as a way to hold basically every widget, from <code>MainScreen</code> to every overlay.</p><p>This was pretty alright. It worked alright, but the question then became, how would you add or remove elements if the <code>MainScreen</code> was inaccesible from <code>key_event</code>. The answer that I thought at the time was callbacks. The callbacks were stored in <code>App</code> and were &quot;flushed&quot; and executed at the end of the event. This was fine to work with.</p><h1 id="Refactor" class="scroll-mt-24">Refactor</h1><p>There was a refactor, mainly because this was a component based system, so a lot of the logic that did not really need to be spread out was in multiple different files. This made it much more harder to track where a certain input was handled. In an effort to combat this, an <code>elm</code> structure was put in place. This meant everything was in the <code>App</code>. The concept of a <code>StackLayout</code> was removed.</p><p>This resulted in access to overlays to be more like this</p><div class="relative"><div class="flex absolute border rounded p-1.5 border-neutral-700 {}hover:bg-neutral-900 bg-neutral-800 right-2 top-2 text-neutral-300 cursor-pointer transition-colors"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"></path><path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z"></path></svg></div><pre class="whitespace-pre-wrap language-rust"><code class="language-rust hljs overflow-clip rounded border border-neutral-700 bg-black bg-neutral-800/30" style="overflow-wrap:anywhere">fn draw(app: &amp;mut App) {
    if let Some(Overlay::Input(input)) = app.last() {
        // Stuff
    }
}
</code></pre></div><p>Notice how there is no reference to self. This is because of the issue described in <a href="#The%20problem" class="underline transition-colors hover:text-gray-400">the problem</a>. This also as a result, does not allow for composable overlays. Since drawing, key and mouse inputs always fetch the overlays data from the last element of the <code>App</code> overlay vec. There is no way you would be able to draw or pass inputs to another overlay, as it fetched that data from someplace else. While this does not really an issue. I was bothered with it.</p><h1 id="Refactor 2" class="scroll-mt-24">Refactor 2</h1><p>Based on the <code>Component</code> architecture laid out in the ratatui documentation. The third attempt consisted of inputs returning a <code>PostEvent</code> structure. This structure consisted of a <code>Action</code> enum which had things like <code>PopLayer</code> and <code>PushLayer</code>. This <code>Action</code> would then be returned to the main loop and be executed. This is very similar to the callbacks solution. Almost the exact same.</p><p>However, it retained the elements of the <code>elm</code> structure. Elements that should have been shared in the first place, such as the <code>tasklist</code> and <code>completed list</code> index which are also accessed by a viewer component are now stored in the <code>App</code>. It was previously passed around using <code>Rc&lt;RefCell&gt;</code> which was significantly more ugly. So that is a plus, I guess?</p><h1 id="Full circle" class="scroll-mt-24">Full circle</h1><p>I&#x27;ve come to start thinking if I&#x27;ve just come full circle. With every iteration, it seems more and more meaningless to worry about how the <code>Overlays</code> are actually implemented and to just focus on adding new features. It might be better to not always just overengineer things and really only consider refactoring when an issue occurs.</p><p>This obviosuly comes with the caveat that it is much harder to refactor thing the larger a project grows. I very much felt this when refactoring this project, and it is relatively small. Perhaps, I should&#x27;ve thought the base architecture a little more through before jumping right in. Perhaps if I did I would&#x27;ve encountered unforseen problems. I&#x27;m not really sure what you would do, I guess just chug along and make cool stuff. In the end <em>design is hard</em>.</p></article></div><div class="hidden shrink-0 grow-0 basis-64 lg:flex"><div class="ml-10 space-y-4"><div class="sticky top-36"><div class="mb-5 text-2xl font-semibold">Table of contents</div><ul class="list-inside space-y-2 underline"><li class=""><a href="#The app" class="text-white underline transition-colors hover:text-gray-400">The app</a></li><li class=""><a href="#The problem" class="text-white underline transition-colors hover:text-gray-400">The problem</a></li><li class=""><a href="#Refactor" class="text-white underline transition-colors hover:text-gray-400">Refactor</a></li><li class=""><a href="#Refactor 2" class="text-white underline transition-colors hover:text-gray-400">Refactor 2</a></li><li class=""><a href="#Full circle" class="text-white underline transition-colors hover:text-gray-400">Full circle</a></li></ul></div></div></div></main></div></main></div><script src="/_next/static/chunks/webpack-eda54a44a67fc8da.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/e334f867d0e43cc2.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/5eacd01f773eed7f.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[33728,[],\"\"]\n7:I[29928,[],\"\"]\n8:I[73994,[\"3185\",\"static/chunks/app/layout-e13c4db65dc2fe40.js\"],\"\"]\n9:I[56954,[],\"\"]\na:I[7264,[],\"\"]\nb:I[68326,[\"721\",\"static/chunks/0d701aaf-6c2ac696d912877c.js\",\"9982\",\"static/chunks/93854f56-90f3d10decf03a41.js\",\"8326\",\"static/chunks/8326-eb81b36abe5748ad.js\",\"5043\",\"static/chunks/5043-8d108951930f4695.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-490776ed35ef27c4.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e334f867d0e43cc2.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"MKPutlDMEzhmxxW5yNQeK\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/design\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"design\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"design\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"sizes\":\"any\"}],[\"$\",\"$L8\",null,{\"src\":\"/load.js\"}],[\"$\",\"$L8\",null,{\"id\":\"MathJax-script\",\"async\":true,\"src\":\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js\",\"strategy\":\"afterInteractive\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_e66fe9\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex min-h-screen flex-col\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"w-full sticky z-10 top-0 background-colour\",\"children\":[\"$\",\"div\",null,{\"className\":\"block p-8 flex w-auto w-full flex-grow items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-grow\",\"children\":[\"$\",\"a\",null,{\"href\":\"/\",\"className\":\"mt-0 block inline-block font-bold text-white\",\"children\":\"¯\\\\_(ツ)_/¯\"}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/blog\",\"className\":\"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400\",\"children\":\"blog\"}],[\"$\",\"a\",null,{\"href\":\"/projects\",\"className\":\"px-4 py-2 leading-none text-white underline transition-colors hover:text-gray-400\",\"children\":\"projects\"}]]}]]}]}],[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"main\",null,{\"className\":\"flex flex-col flex-grow items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative flex flex-grow place-items-center p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"place-items-center text-center\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"mb-10 text-5xl font-bold\",\"style\":{\"color\":\"#EBBAB9\"},\"children\":\"Not found :(\"}]}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"text-xl font-bold text-pink-300\",\"style\":{\"color\":\"#FF9997\"},\"children\":\"Return home?\"}]]}]}]}],\"notFoundStyles\":[],\"initialChildNode\":[null,[\"$\",\"main\",null,{\"className\":\"justify-top flex flex-col items-center p-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"secondary-colour place-items-start text-3xl font-bold\",\"children\":\"My ramblings\"}],[\"$\",\"div\",null,{\"className\":\"mt-10 grid w-10/12 text-left\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"design\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$Lc\",\"$Ld\",null],\"childPropSegment\":\"__PAGE__?{\\\"slug\\\":\\\"design\\\"}\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"childPropSegment\":[\"slug\",\"design\",\"d\"],\"styles\":null}]}]]}],null],\"childPropSegment\":\"blog\",\"styles\":null}]]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:I[88390,[\"721\",\"static/chunks/0d701aaf-6c2ac696d912877c.js\",\"9982\",\"static/chunks/93854f56-90f3d10decf03a41.js\",\"8326\",\"static/chunks/8326-eb81b36abe5748ad.js\",\"5043\",\"static/chunks/5043-8d108951930f4695.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-490776ed35ef27c4.js\"],\"\"]\nf:I[50834,[\"721\",\"static/chunks/0d701aaf-6c2ac696d912877c.js\",\"9982\",\"static/chunks/93854f56-90f3d10decf03a41.js\",\"8326\",\"static/chunks/8326-eb81b36abe5748ad.js\",\"5043\",\"static/chunks/5043-8d108951930f4695.js\",\"308\",\"static/chunks"])</script><script>self.__next_f.push([1,"/app/blog/%5Bslug%5D/page-490776ed35ef27c4.js\"],\"CodeBlock\"]\n10:I[65185,[\"721\",\"static/chunks/0d701aaf-6c2ac696d912877c.js\",\"9982\",\"static/chunks/93854f56-90f3d10decf03a41.js\",\"8326\",\"static/chunks/8326-eb81b36abe5748ad.js\",\"5043\",\"static/chunks/5043-8d108951930f4695.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-490776ed35ef27c4.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"main\",null,{\"className\":\"flex\",\"style\":{\"gridTemplateColumns\":\"1fr 4fr 1fr\"},\"children\":[[\"$\",\"div\",null,{\"className\":\"hidden shrink-0 grow-0 basis-64 sm:flex\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"sticky top-36\",\"children\":[[\"$\",\"li\",null,{\"className\":\"mb-5 text-2xl font-bold\",\"children\":\"All blogs\"}],[[\"$\",\"li\",\"0\",{\"children\":[\"$\",\"$Lb\",null,{\"href\":\"/blog/design\",\"className\":\"text-1xl text-white underline transition-colors hover:text-gray-400\",\"children\":\"Design is hard\"}]}],[\"$\",\"li\",\"1\",{\"children\":[\"$\",\"$Lb\",null,{\"href\":\"/blog/first\",\"className\":\"text-1xl text-white underline transition-colors hover:text-gray-400\",\"children\":\"It's alive!\"}]}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"remove-all flex-grow\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-5 text-3xl font-bold\",\"children\":[\"Design is hard\",\" - \",\"14/01/2024\"]}],[\"$\",\"$Le\",null,{\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"h1\",null,{\"id\":\"The app\",\"className\":\"scroll-mt-24\",\"children\":\"The app\"}],[\"$\",\"p\",null,{\"children\":[\"The design of the Rust TUI app, \",[\"$\",\"code\",null,{\"children\":\"DoTodo\"}],\", should be fairly straightforward. You have tasks, configs and other things. It should not be that hard to design something like this, \",[\"$\",\"strong\",null,{\"children\":\"RIGHT?\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":\"Well, it is fairly simple, with the exception of one things. Overlays. They can get quite painful. Unlike the rest of the app which remain quite static, overlays can be pushed onto the screen and removed off the screen at a moments notice. This incosistent nature along with Rust borrow checker can lead to a lot of pain.\"}],[\"$\",\"h1\",null,{\"id\":\"The problem\",\"className\":\"scroll-mt-24\",\"children\":\"The problem\"}],[\"$\",\"p\",null,{\"children\":\"The problem mainly lies with the concept that you cannot remove the overlay while in a method of an overlay. For example, the following signature with the data structures is not allowed.\"}],[\"$\",\"$Lf\",null,{\"data-language\":\"rust\",\"children\":\"pub struct App {\\n    overlays: Vec\u003cOverlay\u003e,\\n    other: ImportThings\\n}\\n\\npub struct Overlay {\\n    overlay: Things\\n}\\n\\nimpl Overlay {\\n    pub fn key_event(\u0026mut self, app: \u0026mut App) {}\\n}\\n\"}],[\"$\",\"p\",null,{\"children\":[\"This in handsight, is fairly obvious. It is pretty clear that you are able to just remove the overlay from the \",[\"$\",\"code\",null,{\"children\":\"overlays\"}],\" vec and that would definately cause some memory issues. So to combat this, there was a seperate \",[\"$\",\"code\",null,{\"children\":\"StackLayout\"}],\" and the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\". The \",[\"$\",\"code\",null,{\"children\":\"StackLayout\"}],\" acted as a way to hold basically every widget, from \",[\"$\",\"code\",null,{\"children\":\"MainScreen\"}],\" to every overlay.\"]}],[\"$\",\"p\",null,{\"children\":[\"This was pretty alright. It worked alright, but the question then became, how would you add or remove elements if the \",[\"$\",\"code\",null,{\"children\":\"MainScreen\"}],\" was inaccesible from \",[\"$\",\"code\",null,{\"children\":\"key_event\"}],\". The answer that I thought at the time was callbacks. The callbacks were stored in \",[\"$\",\"code\",null,{\"children\":\"App\"}],\" and were \\\"flushed\\\" and executed at the end of the event. This was fine to work with.\"]}],[\"$\",\"h1\",null,{\"id\":\"Refactor\",\"className\":\"scroll-mt-24\",\"children\":\"Refactor\"}],[\"$\",\"p\",null,{\"children\":[\"There was a refactor, mainly because this was a component based system, so a lot of the logic that did not really need to be spread out was in multiple different files. This made it much more harder to track where a certain input was handled. In an effort to combat this, an \",[\"$\",\"code\",null,{\"children\":\"elm\"}],\" structure was put in place. This meant everything was in the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\". The concept of a \",[\"$\",\"code\",null,{\"children\":\"StackLayout\"}],\" was removed.\"]}],[\"$\",\"p\",null,{\"children\":\"This resulted in access to overlays to be more like this\"}],[\"$\",\"$Lf\",null,{\"data-language\":\"rust\",\"children\":\"fn draw(app: \u0026mut App) {\\n    if let Some(Overlay::Input(input)) = app.last() {\\n        // Stuff\\n    }\\n}\\n\"}],[\"$\",\"p\",null,{\"children\":[\"Notice how there is no reference to self. This is because of the issue described in \",[\"$\",\"a\",null,{\"href\":\"#The%20problem\",\"className\":\"underline transition-colors hover:text-gray-400\",\"children\":\"the problem\"}],\". This also as a result, does not allow for composable overlays. Since drawing, key and mouse inputs always fetch the overlays data from the last element of the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\" overlay vec. There is no way you would be able to draw or pass inputs to another overlay, as it fetched that data from someplace else. While this does not really an issue. I was bothered with it.\"]}],[\"$\",\"h1\",null,{\"id\":\"Refactor 2\",\"className\":\"scroll-mt-24\",\"children\":\"Refactor 2\"}],[\"$\",\"p\",null,{\"children\":[\"Based on the \",[\"$\",\"code\",null,{\"children\":\"Component\"}],\" architecture laid out in the ratatui documentation. The third attempt consisted of inputs returning a \",[\"$\",\"code\",null,{\"children\":\"PostEvent\"}],\" structure. This structure consisted of a \",[\"$\",\"code\",null,{\"children\":\"Action\"}],\" enum which had things like \",[\"$\",\"code\",null,{\"children\":\"PopLayer\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"PushLayer\"}],\". This \",[\"$\",\"code\",null,{\"children\":\"Action\"}],\" would then be returned to the main loop and be executed. This is very similar to the callbacks solution. Almost the exact same.\"]}],[\"$\",\"p\",null,{\"children\":[\"However, it retained the elements of the \",[\"$\",\"code\",null,{\"children\":\"elm\"}],\" structure. Elements that should have been shared in the first place, such as the \",[\"$\",\"code\",null,{\"children\":\"tasklist\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"completed list\"}],\" index which are also accessed by a viewer component are now stored in the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\". It was previously passed around using \",[\"$\",\"code\",null,{\"children\":\"Rc\u003cRefCell\u003e\"}],\" which was significantly more ugly. So that is a plus, I guess?\"]}],[\"$\",\"h1\",null,{\"id\":\"Full circle\",\"className\":\"scroll-mt-24\",\"children\":\"Full circle\"}],[\"$\",\"p\",null,{\"children\":[\"I've come to start thinking if I've just come full circle. With every iteration, it seems more and more meaningless to worry about how the \",[\"$\",\"code\",null,{\"children\":\"Overlays\"}],\" are actually implemented and to just focus on adding new features. It might be better to not always just overengineer things and really only consider refactoring when an issue occurs.\"]}],[\"$\",\"p\",null,{\"children\":[\"This obviosuly comes with the caveat that it is much harder to refactor thing the larger a project grows. I very much felt this when refactoring this project, and it is relatively small. Perhaps, I should've thought the base architecture a little more through before jumping right in. Perhaps if I did I would've encountered unforseen problems. I'm not really sure what you would do, I guess just chug along and make cool stuff. In the end \",[\"$\",\"em\",null,{\"children\":\"design is hard\"}],\".\"]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"hidden shrink-0 grow-0 basis-64 lg:flex\",\"children\":[\"$\",\"$L10\",null,{\"tableOfContents\":[{\"title\":\"The app\",\"level\":1},{\"title\":\"The problem\",\"level\":1},{\"title\":\"Refactor\",\"level\":1},{\"title\":\"Refactor 2\",\"level\":1},{\"title\":\"Full circle\",\"level\":1}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"SleepySwords\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Portfolio website\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\nc:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>